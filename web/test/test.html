<html>

<head>
  <meta charset="utf-8">
  <title>tracking.js - face alignment with camera</title>
  <script src="tracker.js"></script>

  <style>
    video,
    canvas {
      margin-left: 230px;
      margin-top: 120px;
      position: absolute;
    }
  </style>
</head>

<body>

  <div class="demo-frame">
    <div class="demo-container">
      <video id="video" width="320" height="240" preload autoplay loop muted></video>
      <canvas id="canvas" width="320" height="240"></canvas>
    </div>
    <p id="debug"></p>
  </div>

  <script>
    window.onload = function () {
      var videoInput = document.getElementById('video');
      navigator.getMedia = (navigator.getUserMedia ||
        navigator.webkitGetUserMedia ||
        navigator.mozGetUserMedia ||
        navigator.msGetUserMedia);
      navigator.getMedia(
        {
          video: true,
          audio: false
        },
        function (stream) {
          if (navigator.mozGetUserMedia) {
            videoInput.mozSrcObject = stream;
          } else {
            var vendorURL = window.URL || window.webkitURL;
            videoInput.src = vendorURL.createObjectURL(stream);
          }
          videoInput.play();
        },
        function (err) {
          console.log("An error occured! " + err);
        }
      );

      var canvas = document.getElementById('canvas');
      var context = canvas.getContext('2d');
      var debug = document.getElementById('debug');
      var ctracker = new clm.tracker();
      ctracker.init();
      ctracker.start(videoInput);
      function positionLoop() {
        requestAnimationFrame(positionLoop);
        var positions = ctracker.getCurrentPosition();
        if (positions) {
          debug.innerText = "RightEye: [" + Math.round(positions[27][0]) + "," + Math.round(positions[27][1]) + "] LeftEye [" + Math.round(positions[32][0]) + "," + Math.round(positions[32][1]) + "]";
        }
        else {
          debug.innerText = "Nothing";
        }
        // positions = [[x_0, y_0], [x_1,y_1], ... ]
        // do something with the positions ...
      }
      positionLoop();
    };
  </script>

</body>

</html>